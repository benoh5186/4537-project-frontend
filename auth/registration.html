<!DOCTYPE html>
<html lang="en">
    <style>
        .registration-form {
            
        }

    </style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <form style="display: flex; flex-direction: column;" id="registration-form" class="registration-form">
        <input type="text" id="email" class="email" placeholder="Email:">
        <input type="password" id="password" class="password" placeholder="Password:">
        <p id="feedback-area"></p>
        <button type="submit">Sign Up</button>
    </form>
</head>
<body>
    
</body>
<script>
    const registrationForm = document.getElementById("registration-form");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const feedbackArea = document.getElementById("feedback-area")

    registrationForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const response = await fetch("http://localhost:8000/api/auth/signup", {
            method: "POST",
            headers: {
                "Content-Type" : "application/json"
            },
            body: JSON.stringify({
                "email" : emailInput.value,
                "password" : passwordInput.value,
                "is_admin" : false 
            })
        })
        if(response.ok) {
            const data = await response.json();
            window.location.href = "/signin.html"
        } else {
            const data = await response.json();
            const issue = data.detail 
            console.log(data)
            if (issue.correct_schema) {
                if (issue.user_exists) {
                feedbackArea.textContent = "User already exists with that email"
            }}
            else {
                if (!issue.email) {
                feedbackArea.textContent = "incorrect email format"
                } else if (!issue.password) {
                    feedbackArea.textContent = "password must be at least 8 length long"
                }
            }


        }
    })

</script>
</html>